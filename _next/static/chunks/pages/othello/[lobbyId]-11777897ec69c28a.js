(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[721],{440:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/othello/[lobbyId]",function(){return t(7887)}])},1292:function(e,r,t){"use strict";t.d(r,{v:function(){return h}});var a=t(5893),s=t(5675),n=t.n(s),o=t(1664),l=t.n(o);let c=e=>(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:e.size,height:e.size,fill:e.fill,children:(0,a.jsx)("path",{d:"M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm7.753 18.305c-.261-.586-.789-.991-1.871-1.241-2.293-.529-4.428-.993-3.393-2.945 3.145-5.942.833-9.119-2.489-9.119-3.388 0-5.644 3.299-2.489 9.119 1.066 1.964-1.148 2.427-3.393 2.945-1.084.25-1.608.658-1.867 1.246-1.405-1.723-2.251-3.919-2.251-6.31 0-5.514 4.486-10 10-10s10 4.486 10 10c0 2.389-.845 4.583-2.247 6.305z"})});var i=t(1733),d=t(7251),u=t(2038),_=t.n(u);let h=e=>{let{user:r}=e,t=async()=>{confirm("Logout?")&&await (0,d.k)()};return(0,a.jsx)("div",{className:_().container,children:(0,a.jsxs)("div",{className:_().main,children:[(0,a.jsx)(l(),{className:_().headerIcon,href:"/",children:(0,a.jsx)(n(),{src:i.D.othello_header_png,height:40,width:160,alt:"othello logo"})}),(0,a.jsxs)("div",{className:_().userBtn,onClick:t,children:[r.photoURL?(0,a.jsx)("img",{className:_().userIcon,src:r.photoURL,height:24,alt:r.displayName}):(0,a.jsx)(c,{size:18,fill:"#555"}),(0,a.jsx)("span",{className:_().userName,children:r.displayName})]})]})})}},7887:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return D}});var a=t(5893),s=t(5904);s.z.string().brand(),s.z.string().brand();let n=s.z.string().brand();var o=t(24),l=t(1163),c=t(7294),i=t(5371),d=t(8239),u=t(1292),_=t(1290),h=t(3377),x=t(4430),v=t.n(x);let m=e=>{let{x:r,y:t,latestMove:s}=e;return(0,a.jsx)(a.Fragment,{children:(null==s?void 0:s.x)===r&&(null==s?void 0:s.y)===t&&(0,a.jsx)("div",{className:v().current})})};var f=t(1247),b=t.n(f);let w=e=>{let{x:r,y:t,color:s,showLatestMove:n,latestMovePos:o,style:l}=e;return(0,a.jsx)("div",{className:b().disc,style:l||{background:1===s?"#000":"#fff"},children:n&&(0,a.jsx)(m,{x:r,y:t,latestMove:o})})};var p=t(2904),y=t.n(p);let j=e=>{let{user:r,board:t,latestMovePos:s,currentTurnPlayerId:n,validMoveList:o,onClick:l}=e;return(0,a.jsx)("div",{className:y().board,children:t.map((e,t)=>e.map((e,c)=>(0,a.jsxs)("div",{className:y().cell,onClick:()=>l(c,t),children:[0!==e&&(0,a.jsx)(w,{x:c,y:t,color:e,showLatestMove:!0,latestMovePos:s}),r.id===n&&o.some(e=>{let{x:r,y:a}=e;return r===c&&a===t})&&(0,a.jsx)("span",{className:y().valid})]},"".concat(c,"-").concat(t))))})};var g=t(3650),N=t.n(g);let I=e=>{let{score:r,lobbyId:t}=e;return(0,a.jsxs)("div",{className:N().modal,children:[(0,a.jsxs)("div",{className:N().wrapper,children:[(0,a.jsx)(w,{showLatestMove:!1,style:{backgroundColor:"#000"}})," ",(0,a.jsxs)("span",{className:N().modalContent,children:["x",r.blackScore]}),(0,a.jsx)(w,{showLatestMove:!1,style:{backgroundColor:"#fff"}})," ",(0,a.jsxs)("span",{className:N().modalContent,children:["x",r.whiteScore]})]}),(0,a.jsx)("p",{className:N().modalContent,children:r.blackScore>r.whiteScore?"BLACK WIN":r.blackScore<r.whiteScore?"WHITE WIN":"TIE"}),(0,a.jsx)("button",{className:N().close,onClick:async()=>await _.x.board._lobbyId(t).restart.$put(),children:"Restart"})]})},S=()=>(0,a.jsx)("div",{className:N().modal,children:(0,a.jsx)("p",{className:N().modalContent,children:"Wait for another player"})}),C=e=>{let{gameStatus:r,score:t,lobbyId:s}=e;return(0,a.jsxs)(a.Fragment,{children:["ended"===r&&(0,a.jsx)(I,{score:t,lobbyId:s}),"waiting"===r&&(0,a.jsx)(S,{})]})};var B=t(9498),k=t.n(B);let E=e=>{let{score:r,currentTurnPlayerId:t,user:s}=e;return(0,a.jsxs)("div",{className:k().scoreBorder,children:[(0,a.jsx)(w,{showLatestMove:!1,style:{backgroundColor:"#000"}}),(0,a.jsxs)("span",{className:k().score,children:["x",r.blackScore]}),(0,a.jsx)("div",{className:k().turnOrder,children:s.id===t?"Your turn":"Opponent turn"}),(0,a.jsx)(w,{showLatestMove:!1,style:{backgroundColor:"#fff"}}),(0,a.jsxs)("span",{className:k().score,children:["x",r.whiteScore]})]})},L=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];(0,c.useEffect)(()=>{if(e){let e=e=>{e.preventDefault(),e.returnValue="Do you really want to leave the game?"},r=()=>{let e=confirm("Do you really want to leave the game?");if(!e)throw l.Router.events.emit("routeChangeError"),"Abort route change. Please ignore this error."};return window.addEventListener("beforeunload",e),l.Router.events.on("routeChangeStart",r),()=>{window.removeEventListener("beforeunload",e),l.Router.events.off("routeChangeStart",r)}}},[e])};var M=t(2781),O=t.n(M);let z=()=>{let e=async(e,r)=>{let t=b.some(t=>t.x===e&&t.y===r);t&&(await _.x.board._lobbyId(B.current).$put({body:{x:e,y:r}}),await k())},[r]=(0,o.KO)(i.L),[t,s]=(0,c.useState)(),[x,v]=(0,c.useState)({blackScore:0,whiteScore:0}),[m,f]=(0,c.useState)(),[b,w]=(0,c.useState)([]),[p,y]=(0,c.useState)(),[g,N]=(0,c.useState)("waiting"),I=(0,l.useRouter)(),{lobbyId:S}=I.query,B=(0,c.useRef)(n.parse(null!=S?S:""));(0,c.useEffect)(()=>{B.current=n.parse(null!=S?S:"")},[S]);let k=async()=>{let e=await _.x.board._lobbyId(B.current).$get().catch(h.F);if(null!==e){s(e.boardData);let r=await _.x.board._lobbyId(B.current).valid_move.$get();w(r),f(e.latestMove),N(e.status),y(e.currentTurnUserId)}},M=async()=>{let e=await _.x.player._lobbyId(B.current).$get();if(2===e.player.length){let r=1===e.player[0].color?e.player[0].score:e.player[1].score,t=2===e.player[0].color?e.player[0].score:e.player[1].score;v({blackScore:r,whiteScore:t})}};return((0,c.useEffect)(()=>{let e=setInterval(()=>{k(),M()},1e3);return()=>clearInterval(e)},[]),L(),(0,c.useEffect)(()=>{let e=async()=>{await _.x.player._lobbyId(B.current).$delete(),await _.x.board._lobbyId(B.current).restart.$put(),await _.x.board._lobbyId(B.current).$delete()};return window.addEventListener("beforeunload",e),I.events.on("routeChangeStart",e),()=>{window.removeEventListener("beforeunload",e),I.events.off("routeChangeStart",e)}},[I.events]),t&&r)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.v,{user:r}),(0,a.jsx)("div",{className:O().container,children:(0,a.jsxs)("div",{className:O().row,children:[(0,a.jsx)(E,{score:x,currentTurnPlayerId:p,user:r}),(0,a.jsx)(j,{user:r,board:t,latestMovePos:m,currentTurnPlayerId:p,validMoveList:b,onClick:e}),(0,a.jsx)(C,{gameStatus:g,score:x,lobbyId:B.current})]})})]}):(0,a.jsx)(d.g,{visible:!0})};var D=z},7251:function(e,r,t){"use strict";t.d(r,{_:function(){return o},k:function(){return l}});var a=t(7908),s=t(328),n=t(3377);let o=async()=>{let e=new a.GH;e.addScope("read:user"),await (0,a.rh)((0,s.l)(),e).catch(n.F)},l=async()=>{await (0,s.l)().signOut()}},2038:function(e){e.exports={container:"BasicHeader_container__5rTZS",main:"BasicHeader_main__yd6De",headerIcon:"BasicHeader_headerIcon__1C3PX",userBtn:"BasicHeader_userBtn__B7CLf",userIcon:"BasicHeader_userIcon__fjiOn",userName:"BasicHeader_userName__vjAjN"}},2904:function(e){e.exports={board:"Board_board__6tNKu",cell:"Board_cell__MKODF",valid:"Board_valid__xAd0x"}},1247:function(e){e.exports={disc:"Disc_disc__UC5zx"}},4430:function(e){e.exports={current:"LatestMove_current__YaF2l"}},3650:function(e){e.exports={wrapper:"Modal_wrapper__3YiG2",modal:"Modal_modal__WbOAn",modalContent:"Modal_modalContent__xzZKf",close:"Modal_close__rDvuP"}},9498:function(e){e.exports={scoreBorder:"ScoreBorder_scoreBorder__DYwoX",score:"ScoreBorder_score__qlN5e",turnOrder:"ScoreBorder_turnOrder__py7ir"}},2781:function(e){e.exports={container:"othello_container__xEmym",row:"othello_row__5176E"}}},function(e){e.O(0,[61,904,774,888,179],function(){return e(e.s=440)}),_N_E=e.O()}]);